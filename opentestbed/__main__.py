import click
from opentestbed import OtBox

import logging

logger = logging.getLogger()
handler = logging.StreamHandler()
formatter = logging.Formatter(
        '%(asctime)s %(name)-12s %(levelname)-8s %(message)s')
handler.setFormatter(formatter)
logger.addHandler(handler)

# import sys
# sys.path.append("/tmp/pycharm-debug-py3k.egg")
# import pydevd
# pydevd.settrace('localhost', port=54433, stdoutToServer=True, stderrToServer=True)

# ============================ main ============================================

@click.command()
@click.option("-t", "--testbed", default="opentestbed",  envvar='OTB_TESTBED', type=click.Choice(['iotlab', 'opentestbed', 'wilab']))
@click.option('-b', '--broker',  envvar='OTB_BROKER', help="The MQTT broker address")
@click.option('-v', '--verbose', count=True)
def opentestbed(testbed, broker, verbose):
    """
    OpenTestbed slave that listens on MQTT for new firmwares that need to be flashed
    """

    otbox = OtBox(testbed=testbed, broker=broker, verbose=(verbose > 0))


if __name__ == '__main__':
    opentestbed()
